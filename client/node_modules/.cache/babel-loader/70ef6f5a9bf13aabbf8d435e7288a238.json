{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\nexport default function useAuth(code) {\n  _s();\n\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const {\n    setToken\n  } = useGlobalState();\n  useEffect(() => {\n    axios.post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n      code: code\n    }).then(res => {\n      setAccessToken(res.data.accessToken);\n      setToken(res.data.accessToken);\n      localStorage.setItem(\"api-key\", res.data.accessToken);\n      setRefreshToken(res.data.refreshToken);\n      setExpiresIn(res.data.expiresIn);\n      window.history.pushState({}, null, \"/\");\n    }).catch(err => {\n      console.log(`Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, err);\n      window.location = \"/\";\n    });\n  }, [code, setToken]);\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios.post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n        refreshToken\n      }).then(res => {\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        spotifyApi.setAccessToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n        setExpiresIn(res.data.expiresIn);\n      }).catch(() => {\n        window.location = \"/\";\n      });\n    }, (expiresIn - 60) * 1000);\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n  return accessToken;\n}\n\n_s(useAuth, \"HHGyg/kBZw+V5XKSTLFlu76fY38=\", false, function () {\n  return [useGlobalState];\n});","map":{"version":3,"sources":["/Users/armanrafati/Documents/Cleanify/client/src/hooks/useAuth.jsx"],"names":["useState","useEffect","axios","useGlobalState","spotifyApi","useAuth","code","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","setToken","post","process","env","REACT_APP_CLEANIFY_BACKEND_URL","then","res","data","localStorage","setItem","window","history","pushState","catch","err","console","log","location","interval","setInterval","CLEANIFY_BACKEND_URL","clearInterval"],"mappings":";;AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,cAAT,QAA+B,2BAA/B;AACA,SAASC,UAAT,QAA2B,eAA3B;AAEA,eAAe,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAAA;;AACpC,QAAM,CAACC,WAAD,EAAcC,cAAd,IAAgCR,QAAQ,EAA9C;AACA,QAAM,CAACS,YAAD,EAAeC,eAAf,IAAkCV,QAAQ,EAAhD;AACA,QAAM,CAACW,SAAD,EAAYC,YAAZ,IAA4BZ,QAAQ,EAA1C;AACA,QAAM;AAAEa,IAAAA;AAAF,MAAeV,cAAc,EAAnC;AAEAF,EAAAA,SAAS,CAAC,MAAM;AACdC,IAAAA,KAAK,CACFY,IADH,CACS,GAAEC,OAAO,CAACC,GAAR,CAAYC,8BAA+B,QADtD,EAC+D;AAC3DX,MAAAA,IAAI,EAAEA;AADqD,KAD/D,EAIGY,IAJH,CAISC,GAAD,IAAS;AACbX,MAAAA,cAAc,CAACW,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAd;AACAM,MAAAA,QAAQ,CAACM,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAR;AACAc,MAAAA,YAAY,CAACC,OAAb,CAAqB,SAArB,EAAgCH,GAAG,CAACC,IAAJ,CAASb,WAAzC;AAEAG,MAAAA,eAAe,CAACS,GAAG,CAACC,IAAJ,CAASX,YAAV,CAAf;AACAG,MAAAA,YAAY,CAACO,GAAG,CAACC,IAAJ,CAAST,SAAV,CAAZ;AACAY,MAAAA,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,IAA7B,EAAmC,GAAnC;AACD,KAZH,EAaGC,KAbH,CAaUC,GAAD,IAAS;AACdC,MAAAA,OAAO,CAACC,GAAR,CACG,oBAAmBd,OAAO,CAACC,GAAR,CAAYC,8BAA+B,QADjE,EAEEU,GAFF;AAIAJ,MAAAA,MAAM,CAACO,QAAP,GAAkB,GAAlB;AACD,KAnBH;AAoBD,GArBQ,EAqBN,CAACxB,IAAD,EAAOO,QAAP,CArBM,CAAT;AAuBAZ,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACQ,YAAD,IAAiB,CAACE,SAAtB,EAAiC;AACjC,UAAMoB,QAAQ,GAAGC,WAAW,CAAC,MAAM;AACjC9B,MAAAA,KAAK,CACFY,IADH,CACS,GAAEC,OAAO,CAACC,GAAR,CAAYiB,oBAAqB,UAD5C,EACuD;AACnDxB,QAAAA;AADmD,OADvD,EAIGS,IAJH,CAISC,GAAD,IAAS;AACbX,QAAAA,cAAc,CAACW,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAd;AACAM,QAAAA,QAAQ,CAACM,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAR;AACAH,QAAAA,UAAU,CAACI,cAAX,CAA0BW,GAAG,CAACC,IAAJ,CAASb,WAAnC;AACAc,QAAAA,YAAY,CAACC,OAAb,CAAqB,SAArB,EAAgCH,GAAG,CAACC,IAAJ,CAASb,WAAzC;AACAK,QAAAA,YAAY,CAACO,GAAG,CAACC,IAAJ,CAAST,SAAV,CAAZ;AACD,OAVH,EAWGe,KAXH,CAWS,MAAM;AACXH,QAAAA,MAAM,CAACO,QAAP,GAAkB,GAAlB;AACD,OAbH;AAcD,KAf2B,EAezB,CAACnB,SAAS,GAAG,EAAb,IAAmB,IAfM,CAA5B;AAiBA,WAAO,MAAMuB,aAAa,CAACH,QAAD,CAA1B;AACD,GApBQ,EAoBN,CAACtB,YAAD,EAAeE,SAAf,EAA0BE,QAA1B,CApBM,CAAT;AAsBA,SAAON,WAAP;AACD;;GApDuBF,O;UAIDF,c","sourcesContent":["import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\n\nexport default function useAuth(code) {\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const { setToken } = useGlobalState();\n\n  useEffect(() => {\n    axios\n      .post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n        code: code,\n      })\n      .then((res) => {\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n        window.history.pushState({}, null, \"/\");\n      })\n      .catch((err) => {\n        console.log(\n          `Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`,\n          err\n        );\n        window.location = \"/\";\n      });\n  }, [code, setToken]);\n\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios\n        .post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n          refreshToken,\n        })\n        .then((res) => {\n          setAccessToken(res.data.accessToken);\n          setToken(res.data.accessToken);\n          spotifyApi.setAccessToken(res.data.accessToken);\n          localStorage.setItem(\"api-key\", res.data.accessToken);\n          setExpiresIn(res.data.expiresIn);\n        })\n        .catch(() => {\n          window.location = \"/\";\n        });\n    }, (expiresIn - 60) * 1000);\n\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n\n  return accessToken;\n}\n"]},"metadata":{},"sourceType":"module"}