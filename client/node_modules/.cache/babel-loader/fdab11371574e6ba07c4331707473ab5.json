{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\nexport default function useAuth(code) {\n  _s();\n\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const {\n    setToken\n  } = useGlobalState();\n  useEffect(() => {\n    axios.get(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/test`, {\n      code: code\n    }).then(res => console.log(\"Test api call result\", res));\n    axios.post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n      code: code\n    }).then(res => {\n      console.log(\"Response\", res);\n      setAccessToken(res.data.accessToken);\n      setToken(res.data.accessToken);\n      localStorage.setItem(\"api-key\", res.data.accessToken);\n      setRefreshToken(res.data.refreshToken);\n      setExpiresIn(res.data.expiresIn);\n      window.history.pushState({}, null, \"/\");\n    }).catch(err => {\n      console.log(`Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, \"code is\", code, \"error is\", err);\n      window.location = \"/\";\n    });\n  }, [code, setToken]);\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios.post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n        refreshToken\n      }).then(res => {\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        spotifyApi.setAccessToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n        setExpiresIn(res.data.expiresIn);\n      }).catch(() => {\n        window.location = \"/\";\n      });\n    }, (expiresIn - 60) * 1000);\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n  return accessToken;\n}\n\n_s(useAuth, \"HHGyg/kBZw+V5XKSTLFlu76fY38=\", false, function () {\n  return [useGlobalState];\n});","map":{"version":3,"sources":["/Users/armanrafati/Documents/Cleanify/client/src/hooks/useAuth.jsx"],"names":["useState","useEffect","axios","useGlobalState","spotifyApi","useAuth","code","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","setToken","get","process","env","REACT_APP_CLEANIFY_BACKEND_URL","then","res","console","log","post","data","localStorage","setItem","window","history","pushState","catch","err","location","interval","setInterval","CLEANIFY_BACKEND_URL","clearInterval"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\n\nexport default function useAuth(code) {\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const { setToken } = useGlobalState();\n\n  useEffect(() => {\n    axios\n      .get(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/test`, {\n        code: code,\n      })\n      .then((res) => console.log(\"Test api call result\", res));\n    axios\n      .post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n        code: code,\n      })\n      .then((res) => {\n        console.log(\"Response\", res);\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n        window.history.pushState({}, null, \"/\");\n      })\n      .catch((err) => {\n        console.log(\n          `Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`,\n          \"code is\",\n          code,\n          \"error is\",\n          err\n        );\n        window.location = \"/\";\n      });\n  }, [code, setToken]);\n\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios\n        .post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n          refreshToken,\n        })\n        .then((res) => {\n          setAccessToken(res.data.accessToken);\n          setToken(res.data.accessToken);\n          spotifyApi.setAccessToken(res.data.accessToken);\n          localStorage.setItem(\"api-key\", res.data.accessToken);\n          setExpiresIn(res.data.expiresIn);\n        })\n        .catch(() => {\n          window.location = \"/\";\n        });\n    }, (expiresIn - 60) * 1000);\n\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n\n  return accessToken;\n}\n"]},"metadata":{},"sourceType":"module"}