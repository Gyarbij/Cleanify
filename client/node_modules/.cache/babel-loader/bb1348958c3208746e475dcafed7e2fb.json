{"ast":null,"code":"import _slicedToArray from\"/Users/armanrafati/Documents/Cleanify/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import axios from\"axios\";import{useGlobalState}from\"../contexts/GlobalContext\";import{spotifyApi}from\"../pages/Home\";export default function useAuth(code){var _useState=useState(),_useState2=_slicedToArray(_useState,2),accessToken=_useState2[0],setAccessToken=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),refreshToken=_useState4[0],setRefreshToken=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),expiresIn=_useState6[0],setExpiresIn=_useState6[1];var _useGlobalState=useGlobalState(),setToken=_useGlobalState.setToken;useEffect(function(){axios.post(\"\".concat(process.env.CLEANIFY_BACKEND_URL,\"/login\"),{code:code}).then(function(res){setAccessToken(res.data.accessToken);setToken(res.data.accessToken);localStorage.setItem(\"api-key\",res.data.accessToken);setRefreshToken(res.data.refreshToken);setExpiresIn(res.data.expiresIn);window.history.pushState({},null,\"/\");}).catch(function(err){console.log(\"error in auth\",err);window.location=\"/\";});},[code,setToken]);useEffect(function(){if(!refreshToken||!expiresIn)return;var interval=setInterval(function(){axios.post(\"\".concat(process.env.CLEANIFY_BACKEND_URL,\"/refresh\"),{refreshToken:refreshToken}).then(function(res){setAccessToken(res.data.accessToken);setToken(res.data.accessToken);spotifyApi.setAccessToken(res.data.accessToken);localStorage.setItem(\"api-key\",res.data.accessToken);setExpiresIn(res.data.expiresIn);}).catch(function(){window.location=\"/\";});},(expiresIn-60)*1000);return function(){return clearInterval(interval);};},[refreshToken,expiresIn,setToken]);return accessToken;}","map":{"version":3,"sources":["/Users/armanrafati/Documents/Cleanify/client/src/hooks/useAuth.jsx"],"names":["useState","useEffect","axios","useGlobalState","spotifyApi","useAuth","code","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","setToken","post","process","env","CLEANIFY_BACKEND_URL","then","res","data","localStorage","setItem","window","history","pushState","catch","err","console","log","location","interval","setInterval","clearInterval"],"mappings":"kIAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,cAAT,KAA+B,2BAA/B,CACA,OAASC,UAAT,KAA2B,eAA3B,CAEA,cAAe,SAASC,CAAAA,OAAT,CAAiBC,IAAjB,CAAuB,CACpC,cAAsCN,QAAQ,EAA9C,wCAAOO,WAAP,eAAoBC,cAApB,eACA,eAAwCR,QAAQ,EAAhD,yCAAOS,YAAP,eAAqBC,eAArB,eACA,eAAkCV,QAAQ,EAA1C,yCAAOW,SAAP,eAAkBC,YAAlB,eACA,oBAAqBT,cAAc,EAAnC,CAAQU,QAAR,iBAAQA,QAAR,CAEAZ,SAAS,CAAC,UAAM,CACdC,KAAK,CACFY,IADH,WACWC,OAAO,CAACC,GAAR,CAAYC,oBADvB,WACqD,CACjDX,IAAI,CAAJA,IADiD,CADrD,EAIGY,IAJH,CAIQ,SAACC,GAAD,CAAS,CACbX,cAAc,CAACW,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAd,CACAM,QAAQ,CAACM,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAR,CACAc,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAgCH,GAAG,CAACC,IAAJ,CAASb,WAAzC,EAEAG,eAAe,CAACS,GAAG,CAACC,IAAJ,CAASX,YAAV,CAAf,CACAG,YAAY,CAACO,GAAG,CAACC,IAAJ,CAAST,SAAV,CAAZ,CACAY,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,CAA6B,IAA7B,CAAmC,GAAnC,EACD,CAZH,EAaGC,KAbH,CAaS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BF,GAA7B,EACAJ,MAAM,CAACO,QAAP,CAAkB,GAAlB,CACD,CAhBH,EAiBD,CAlBQ,CAkBN,CAACxB,IAAD,CAAOO,QAAP,CAlBM,CAAT,CAoBAZ,SAAS,CAAC,UAAM,CACd,GAAI,CAACQ,YAAD,EAAiB,CAACE,SAAtB,CAAiC,OACjC,GAAMoB,CAAAA,QAAQ,CAAGC,WAAW,CAAC,UAAM,CACjC9B,KAAK,CACFY,IADH,WACWC,OAAO,CAACC,GAAR,CAAYC,oBADvB,aACuD,CACnDR,YAAY,CAAZA,YADmD,CADvD,EAIGS,IAJH,CAIQ,SAACC,GAAD,CAAS,CACbX,cAAc,CAACW,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAd,CACAM,QAAQ,CAACM,GAAG,CAACC,IAAJ,CAASb,WAAV,CAAR,CACAH,UAAU,CAACI,cAAX,CAA0BW,GAAG,CAACC,IAAJ,CAASb,WAAnC,EACAc,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAgCH,GAAG,CAACC,IAAJ,CAASb,WAAzC,EACAK,YAAY,CAACO,GAAG,CAACC,IAAJ,CAAST,SAAV,CAAZ,CACD,CAVH,EAWGe,KAXH,CAWS,UAAM,CACXH,MAAM,CAACO,QAAP,CAAkB,GAAlB,CACD,CAbH,EAcD,CAf2B,CAezB,CAACnB,SAAS,CAAG,EAAb,EAAmB,IAfM,CAA5B,CAiBA,MAAO,kBAAMsB,CAAAA,aAAa,CAACF,QAAD,CAAnB,EAAP,CACD,CApBQ,CAoBN,CAACtB,YAAD,CAAeE,SAAf,CAA0BE,QAA1B,CApBM,CAAT,CAsBA,MAAON,CAAAA,WAAP,CACD","sourcesContent":["import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\n\nexport default function useAuth(code) {\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const { setToken } = useGlobalState();\n\n  useEffect(() => {\n    axios\n      .post(`${process.env.CLEANIFY_BACKEND_URL}/login`, {\n        code,\n      })\n      .then((res) => {\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n        window.history.pushState({}, null, \"/\");\n      })\n      .catch((err) => {\n        console.log(\"error in auth\", err);\n        window.location = \"/\";\n      });\n  }, [code, setToken]);\n\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios\n        .post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n          refreshToken,\n        })\n        .then((res) => {\n          setAccessToken(res.data.accessToken);\n          setToken(res.data.accessToken);\n          spotifyApi.setAccessToken(res.data.accessToken);\n          localStorage.setItem(\"api-key\", res.data.accessToken);\n          setExpiresIn(res.data.expiresIn);\n        })\n        .catch(() => {\n          window.location = \"/\";\n        });\n    }, (expiresIn - 60) * 1000);\n\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n\n  return accessToken;\n}\n"]},"metadata":{},"sourceType":"module"}