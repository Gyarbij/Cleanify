{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\nexport default function useAuth(code) {\n  _s();\n\n  const instance = axios.create({\n    baseURL: process.env.REACT_APP_CLEANIFY_BACKEND_URL,\n    timeout: 1000,\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\n    }\n  });\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const {\n    setToken\n  } = useGlobalState();\n  useEffect(() => {\n    instance.post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n      code: code\n    }).then(res => {\n      console.log(\"Response\", res);\n      setAccessToken(res.data.accessToken);\n      setToken(res.data.accessToken);\n      localStorage.setItem(\"api-key\", res.data.accessToken);\n      setRefreshToken(res.data.refreshToken);\n      setExpiresIn(res.data.expiresIn);\n      window.history.pushState({}, null, \"/\");\n    }).catch(err => {\n      console.log(`Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, \"code is\", code, \"error is\", err);\n      window.location = \"/\";\n    });\n  }, [code, setToken]);\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios.post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n        refreshToken\n      }).then(res => {\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        spotifyApi.setAccessToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n        setExpiresIn(res.data.expiresIn);\n      }).catch(() => {\n        window.location = \"/\";\n      });\n    }, (expiresIn - 60) * 1000);\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n  return accessToken;\n}\n\n_s(useAuth, \"HHGyg/kBZw+V5XKSTLFlu76fY38=\", false, function () {\n  return [useGlobalState];\n});","map":{"version":3,"sources":["/Users/armanrafati/Documents/Cleanify/client/src/hooks/useAuth.jsx"],"names":["useState","useEffect","axios","useGlobalState","spotifyApi","useAuth","code","instance","create","baseURL","process","env","REACT_APP_CLEANIFY_BACKEND_URL","timeout","headers","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","setToken","post","then","res","console","log","data","localStorage","setItem","window","history","pushState","catch","err","location","interval","setInterval","CLEANIFY_BACKEND_URL","clearInterval"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useGlobalState } from \"../contexts/GlobalContext\";\nimport { spotifyApi } from \"../pages/Home\";\n\nexport default function useAuth(code) {\n  const instance = axios.create({\n    baseURL: process.env.REACT_APP_CLEANIFY_BACKEND_URL,\n    timeout: 1000,\n    headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n  });\n\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  const { setToken } = useGlobalState();\n\n  useEffect(() => {\n    instance\n      .post(`${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`, {\n        code: code,\n      })\n      .then((res) => {\n        console.log(\"Response\", res);\n        setAccessToken(res.data.accessToken);\n        setToken(res.data.accessToken);\n        localStorage.setItem(\"api-key\", res.data.accessToken);\n\n        setRefreshToken(res.data.refreshToken);\n        setExpiresIn(res.data.expiresIn);\n        window.history.pushState({}, null, \"/\");\n      })\n      .catch((err) => {\n        console.log(\n          `Error posting to ${process.env.REACT_APP_CLEANIFY_BACKEND_URL}/login`,\n          \"code is\",\n          code,\n          \"error is\",\n          err\n        );\n        window.location = \"/\";\n      });\n  }, [code, setToken]);\n\n  useEffect(() => {\n    if (!refreshToken || !expiresIn) return;\n    const interval = setInterval(() => {\n      axios\n        .post(`${process.env.CLEANIFY_BACKEND_URL}/refresh`, {\n          refreshToken,\n        })\n        .then((res) => {\n          setAccessToken(res.data.accessToken);\n          setToken(res.data.accessToken);\n          spotifyApi.setAccessToken(res.data.accessToken);\n          localStorage.setItem(\"api-key\", res.data.accessToken);\n          setExpiresIn(res.data.expiresIn);\n        })\n        .catch(() => {\n          window.location = \"/\";\n        });\n    }, (expiresIn - 60) * 1000);\n\n    return () => clearInterval(interval);\n  }, [refreshToken, expiresIn, setToken]);\n\n  return accessToken;\n}\n"]},"metadata":{},"sourceType":"module"}